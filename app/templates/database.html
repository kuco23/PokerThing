{% extends "template_base" %}

{% block database %}

<div class='container'>

<div class='container' id='table-specs'>
	<form class="form-horizontal">
		<div class="form-group">
			<div class="col-sm-12">
				<select class='form-control' id='table-select'>
					<option>Accounts</option>
					<option>Players</option>
					<option>PokerTables</option>
					<option>PlayerActions</option>
					<option>Rounds</option>
				</select>
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-12">
				<input id='table-search' class="form-control" type="text" placeholder="Search Table">
			</div>
		</div>
	</form>
</div>

<div class='container grid-table'>
	<table id='table_repr' class='table table-dark'>
		<tbody id='table-out'></tbody>
	</table>
</div>

</div>

<script>
	'use strict'

	let ClientCode = {
		GETTABLE: 0,
		GETPLAYER: 1
	};

	let DbTable = {
		Accounts: 'accounts',
		PokerTables: 'pokertables',
		Players: 'players',
		Rounds: 'rounds',
		Boards: 'boards',
		PlayerCards: 'playercards',
		PlayerActions: 'playeractions'
	};

	let table_option = $('#table-select');
	let table_options = $('#table-select > option');
	let table_out = $('#table-out');
	let table_search = $('#table-search');
	let table = null;

	function serverSend(json, callback) {
		$.ajax('/database', {
            type: 'POST',
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            data: json,
            timeout: 2000,
            success: function (data, status, xhr) {
				table = data;
				callback(data);
			},
            error: function (jqXhr, textStatus, errorMessage) {
				console.log("Error");
			},
		});
	}

	function fillTable(data) {
		table_out.html('<tr>');
		data.columns.forEach(function(x) {
			table_out.append('<th>' + x + '</th>');
		});
		table_out.append('</tr>');
		data.rows.forEach(function(row) {
			table_out.append('<tr>');
			row.forEach(function (td) {
				table_out.append('<td>' + td + '</td>');
			});
			table_out.append('</tr>');
		});
	}

	table_options.click(function() {
		let option = $( this ).text();
		let data = JSON.stringify({
			id: ClientCode.GETTABLE,
			data: {
				table: DbTable[option]
			}
		});
		serverSend(data, fillTable);
	});

	table_search.on("change paste keyup", function() {
		if (table == null) return;
		let search = $( this ).val();
		let selected = [];
		table.rows.forEach(function(row) {
			for (let i = 0; i < row.length; i++) {
				if (String(row[i]).includes(search)) {
					selected.push(row);
					break;
				}
			}
		});
		fillTable({
			columns: table.columns,
			rows: selected
		});
	});
	
		
</script>
{% endblock %}