{% extends "template_base" %}

{% block table %}

<script>
    var ServerCode = {
        MESSAGE: -6,
        NEWROUND: 1,
        NEWTURN: 2,
        DEALTCARDS: 3,
        SMALLBLIND: 4,
        BIGBLIND: 5,
        PLAYERCHECK: 6,
        PLAYERCALL: 7,
        PLAYERFOLD: 8,
        PLAYERRAISE: 9,
        PLAYERALLIN: 10,
        PLAYERAMOUNTTOCALL: 11,
        PUBLICCARDSHOW: 12,
        DECLAREPREMATUREWINNER: 13,
        DECLAREFINISHEDWINNER: 14,
        ROUNDFINISHED: 15,
        INTRODUCEPLAYER: 16
    };
    var ClientCode = {
        MESSAGE: -6,
        FOLD: -5,
        CHECK: -4,
        CALL: -3,
        RAISE: -2,
        ALLIN: -1
    };
</script>

<div id='action_out'></div>
<div id='action_in'>
    <input type=submit name='check' id='check' value='CHECK' />
    <input type=submit name='fold' id='fold' value='FOLD' />
    <label for='amount'>AMOUNT</label>
    <input type=range name='amount' id='amount' />
    <input type=submit name='raise' id='raise' value='RAISE' />
</div>

<div id='table_cards'></div>
<div id='player_cards'></div>
<div id='player_list'></div>
<div id='state'></div>

<div id='tchat'>
    <input type=text name='message' id='message_in' />
    <button name='send' id='send'>Send</button>
    <div id='message_out'>
    </div>
</div>

<script>
    'use strict'
    const message_in = $("#message_in");
    const message_out = $("#message_out");
    const message_send = $('#send');
    const action_in = $('#action_in');
    const action_out = $('#action_out');
    const table_cards = $('#table_cards');
    const player_cards = $('#player_cards');
    const player_list = $('#player_list');
    const state = $('#state');

    const ws = new WebSocket("ws://" + window.location.host + "/feed");
    ws.onopen = function() {
        console.log('Socket Opened');
    };
    ws.onclose = function() {
        console.log('Socket Closed');
    };
    ws.onmessage = function(rcv) {
        let server_data = JSON.parse(rcv.data);
        if (server_data.id == ServerCode.INTRODUCEPLAYER) {
            let data = server_data.data;
            $.cookie("player_id", data.player_id);
            $.cookie('player_name', data.player_name);
            $.cookie('player_money', data.player_money);
            player_list.append(
                '<div ' + 'id=' + data.player_id + '>' +
                    '<span>' + data.player_name + '</span>' +
                    '<span>' + data.player_money + '</span>' +
                '</div>' 
            );
        } else if (server_data.id == ServerCode.DEALTCARDS) {
            player_cards.text(server_data.data)
        } else if (server_data.id == ServerCode.NEWROUND) {
            return;
        } else if (server_data.id == ServerCode.MESSAGE) {
            console.log('inner' + server_data.message);
            message_out.append(
                "<div>" +
                    "<span>" + server_data.username + "</span>" +
                    "<span>" + server_data.message + "</span>" +
                "</div>"
            );
        }
    };
    message_send.click(function() {
        ws.send(JSON.stringify({
            id: ClientCode.MESSAGE,
            data: message_in.val()
        }));
    });

</script>

{% endblock %}